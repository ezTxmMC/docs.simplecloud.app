import { Button } from "../../../components/mdx";

export const metadata = {
   title: 'Server Connection Plugin',
   description: 'Manage player connections and server navigation in your network'
}

# Server Connection Plugin

The Server Connection Plugin provides comprehensive player connection management for your network, including network join handling, fallback servers, and navigation commands. {{ className: 'lead' }}

<div className="not-prose">
   <Button href="https://github.com/theSimpleCloud/server-connection-plugin/releases" arrow="right">
      <>Download</>
   </Button>
</div>

## Supported Server Softwares

The following table shows all currently supported proxy implementations:

| Software   | This Plugin | Server API |
| ---------- | ----------- | ---------- |
| Velocity   | Yes         | Yes        |
| Bungeecord | Yes         | Yes        |
| Gate       | Planned     | Yes        |
| Other*     | Varies      | No         |

<Note>
    *Support for other proxies is possible through custom implementation if the [server API](/api#server) is available in your preferred [programming language](/api).
</Note>

## Quick Setup

1. Download the plugin for your proxy software
2. Place it in your proxy template's plugins folder
3. Configure using `config.yml`

## Connection Targets

Connection targets are matchers for servers in your network. Based on their server-name-matcher, they can match single servers or one / multiple server groups. Allowed server-name-matcher operations are listed under the next heading. Each target can have specific rules for server name matching as well as for availability for players:

The following example demonstrates, how a connections configuration could look like using different server-name-matchers and rules

```yaml
connections:
  # This connection matches servers which's name starts with "lobby" and has no rules for access restriction.
  - name: "lobby"
    server-name-matcher:
      operation: "STARTS_WITH"
      value: "lobby"

  # This connection targets a server which's name is "sb-spawn" and includes two access rules.
  - name: "skyblock-spawn"
    server-name-matcher:
      operation: "EQUALS"
      value: "sb-spawn"
    rules:
     # This rule requires players to have the permission "network.join.skyblock" to access this connection
     - type: "PERMISSION"
       name: "network.join.skyblock"
       value: "true" # "true", because the permission check is expected to be positive.
     
     # This rule requires the environment variable "SKYBLOCK_JOIN_STATE" to not be set to "maintenance" for players to
     # access the connection, while allowing players with the permission "rank.admin" to bypass this check.
     - type: "ENV"
       name: "SKYBLOCK_JOIN_STATE"
       value: "maintenance"
       operation: "EQUALS"
       negate: true # Negates the EQUALS operation, so the environment variable shall not be equal "maintenance".
       bypassPermission: "rank.admin" # Adds a permission that lets users bypass this check.
```

### Matcher Operations

Matcher operations are used to either match server names for connections (see above) or perform environment variable rule checks (see below)

| Operation     | Description                   |
| ------------- | ----------------------------- |
| `EQUALS`      | Exact value match             |
| `STARTS_WITH` | Value begins with given value |
| `ENDS_WITH`   | Value ends with given value   |
| `CONTAINS`    | Value contains given value    |
| `REGEX`       | Value matches given RegEx     |

## Features

### Network Join Handling

Manages initial servers for player connections to your network. Configure which servers players will be connected to and handling of unavailable targets:

```yaml
network-join-target:
  enabled: true
  no-target-connections-found-message: "Couldn't connect you to the network because no target servers are available."
  target-connections:
    - name: "lobby"
      priority: 0
```

### Fallback System

Handles player redirection when kicked from servers or during server shutdowns:

```yaml
fallback-connections:
  enabled: true
  no-target-connections-found-message: "You have been disconnected from the network since you have been kicked and no fallback server are available."
  target-connections:
    - name: "skyblock-spawn"
      priority: 1
      from:
        - operation: "STARTS_WITH"
          value: "skyblock-island-"
    - name: "lobby"
      priority: 0
```

### Navigation Commands

Create custom commands for server navigation:

```yaml
commands:
  - name: "lobby"
    aliases:
      - "l"
      - "hub"
      - "quit"
      - "leave"
    target-connections:
      - name: "lobby"
        priority: 0
    already-connected-message: "<red>You are already connected to the lobby!"
    no-target-connections-found-message: "There are no lobby servers available at the moment."
    permission: ""
```

## Priority System and Target Selection

All above features support priority levels for their target-connections:
- Lower numbers indicate higher priority
- The system tries the highest priority (0) first
- Falls back to lower priorities if needed (e.g.: insufficient permissions or no available target servers)

Target-connections can also specify a from-criteria which works exactly like the server-name-matcher of connections. It allows to only consider a target if the name of the server the player was previously on matches specified criteria.
```yaml
target-connections:
  - name: "lobby"
    priority: 0
    from:
      - operation: "STARTS_WITH"
        value: "bw"
```

## Message Customization

Each feature supports custom messages for various scenarios. [**MiniMessage**](https://docs.advntr.dev/minimessage/format#standard-tags) format is supported for styling.:

```yaml
# Network join messages
network-join-target:
  no-target-connections-found-message: "<green>Custom message"

# Fallback messages
fallback-connections:
  no-target-connections-found-message: "<bold>Custom message"

# Command messages
commands:
  - name: "lobby"
    already-connected-message: "Custom message"
    no-target-connections-found-message: "Custom message"
```

## Common Configurations

### Game Server Setup
Here's an example configuration for a minigame network:

```yaml
connections:
  - name: "lobby"
    server-name-matcher:
      operation: "STARTS_WITH"
      value: "lobby"
  - name: "bedwars"
    permission: "minigame.bedwars"
    server-name-matcher:
      operation: "STARTS_WITH"
      value: "bw"

network-join-target:
  enabled: true
  target-connections:
    - name: "lobby"
      priority: 0

fallback-connections:
  enabled: true
  target-connections:
    - name: "lobby"
      priority: 0
    - name: "bedwars" # Will fall back to another bedwars server if the player is kicked from a bedwars server and no lobby is available 
      priority: 1
      from:
        - operation: "STARTS_WITH"
          value: "bw"

commands:
  - name: "lobby"
    aliases: ["hub", "l"]
    target-connections:
      - name: "lobby"
        priority: 0
  - name: "bedwars"
    aliases: ["bw"]
    permission: "minigame.bedwars"
    target-connections:
      - name: "bedwars"
        priority: 0
```

### Multi-Lobby System
Example for managing multiple lobby types:

```yaml
connections:
  - name: "main-lobby"
    server-name-matcher:
      operation: "EQUALS"
      value: "lobby-main"
  - name: "premium-lobby"
    permission: "vip.lobby"
    server-name-matcher:
      operation: "EQUALS"
      value: "lobby-premium"

network-join-target:
  enabled: true
  target-connections:
    - name: "premium-lobby"
      priority: 0
    - name: "main-lobby"
      priority: 1

commands:
  - name: "lobby"
    aliases: ["hub"]
    target-connections:
      - name: "premium-lobby"
        priority: 0
      - name: "main-lobby"
        priority: 1
```

## Advanced Usage

### Permission-Based Routing
The plugin can route players based on permissions:

- VIP players can be sent to premium servers first
- Staff members can be directed to specific lobbies
- Game access can be restricted by permissions

### Fallback Chains
Create sophisticated fallback chains:

1. Players are first redirected to game-specific lobbies
2. Then to general game lobbies if specific ones are full
3. Finally to main lobbies if no game lobbies are available

### Command Hierarchies
Implement complex command structures:

- Main navigation commands (`/lobby`, `/hub`)
- Game-specific commands (`/bedwars`, `/survival`)
- VIP-only commands with permission checks
- Staff commands for server management

The plugin's flexible configuration system allows you to create intuitive and efficient player routing that scales with your network's needs.

## What's Next?

- [Proxy Configuration](/proxy)
- [Group Management](/groups)
- [Plugin Development](/plugins)
