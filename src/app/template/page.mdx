import { CodeGroup } from "../../components/Code";
import { Note } from "../../components/mdx";

export const metadata = {
  title: 'Templates',
  description: 'Learn about SimpleCloud\'s flexible template system'
}

# Templates

Templates in SimpleCloud v3 provide a powerful and flexible way to manage server configurations. Unlike v2's fixed directory structure, templates now use a processor-based system that allows for dynamic file management and advanced templating features. {{ className: 'lead' }}

## Understanding Templates

Templates consist of actions that are processed by specific template processors. Each action defines how files should be copied between directories, allowing for:

- Dynamic file copying during server startup/shutdown
- Random file selection from template directories
- Template inheritance and extending
- Absolute and relative path support

## Template Structure

Templates are defined in YAML files located in `/droplets/serverhost-droplet/templates`. Each template can use multiple processors and define multiple actions:

```yaml
extends: "every_paper"
destinations:
  - copy-from: "cache/paper/%GROUP%/cache"
    copy-to: "cache"
  - copy-from: "cache/paper/%GROUP%/libraries"
    copy-to: "libraries"
  - copy-from: "%GROUP%"
    copy-to: ""
shutdown-destinations:
  - copy-from: "cache"
    copy-to: "cache/paper/%GROUP%/cache"
  - copy-from: "libraries"
    copy-to: "cache/paper/%GROUP%/libraries"
```

## Template Processors

SimpleCloud provides three template processors:

1. **destinations**
- Copies files during server startup
- Supports direct file and directory copying
- Most commonly used processor

2. **random-destinations**
- Randomly selects and copies files
- Useful for map rotation systems
- Supports directory-based randomization

3. **shutdown-destinations**
- Executes copying when server stops
- Perfect for log archiving
- Allows backup of runtime files

## Path Variables

Templates support dynamic path variables:

| Variable | Description | Example |
|----------|-------------|---------|
| %SERVER% | Server name with ID | `lobby-1` |
| %GROUP% | Group name | `lobby` |
| %NUMERICAL_ID% | Server instance ID | `1` |

<Note>
    Paths starting with `/` are treated as absolute paths. All others are relative to the server directory.
</Note>

## Template Inheritance

Templates can extend other templates using the `extends` property:

```yaml
# paper_base.yml
extends: "every_paper"
destinations:
  - copy-from: "cache/paper/%GROUP%/cache"
    copy-to: "cache"
  - copy-from: "cache/paper/%GROUP%/libraries"
    copy-to: "libraries"
  - copy-from: "%GROUP%"
    copy-to: ""
shutdown-destinations:
  - copy-from: "cache"
    copy-to: "cache/paper/%GROUP%/cache"
  - copy-from: "libraries"
    copy-to: "cache/paper/%GROUP%/libraries"

# minigame.yml
extends: "paper_base"
random-destinations:
  - copy-from: "worlds/%GROUP%"
    copy-to: "world"
shutdown-destinations:
  - copy-from: "world"
    copy-to: "worlds/%GROUP%/backup_%SERVER%"
  - copy-from: "logs"
    copy-to: "logs/%GROUP%/%SERVER%"
```

## Example Configurations

### Paper Server Template
<CodeGroup>
    ```yaml {{title: 'templates/paper_base.yml'}}
    extends: "every_paper"
    destinations:
    - copy-from: "cache/paper/%GROUP%/cache"
    copy-to: "cache"
    - copy-from: "cache/paper/%GROUP%/libraries"
    copy-to: "libraries"
    - copy-from: "%GROUP%"
    copy-to: ""
    shutdown-destinations:
    - copy-from: "cache"
    copy-to: "cache/paper/%GROUP%/cache"
    - copy-from: "libraries"
    copy-to: "cache/paper/%GROUP%/libraries"
    ```
</CodeGroup>

### Game Mode Template
<CodeGroup>
    ```yaml {{title: 'templates/minigame.yml'}}
    extends: "paper_base"
    random-destinations:
    - copy-from: "worlds/%GROUP%"
    copy-to: "world"
    shutdown-destinations:
    - copy-from: "world"
    copy-to: "worlds/%GROUP%/backup_%SERVER%"
    - copy-from: "logs"
    copy-to: "logs/%GROUP%/%SERVER%"
    ```
</CodeGroup>

## Best Practices

1. **Template Organization**
- Use clear template naming
- Group common configurations in base templates
- Document template dependencies

2. **Path Management**
- Use relative paths when possible
- Leverage path variables for flexibility
- Keep consistent directory structure

## What's Next?

- [Server Host Configuration](/droplet/serverhost)
- [Group Management](/groups)
- [Plugin Setup](/plugins)
- [Advanced Templates](/advanced-templates)
