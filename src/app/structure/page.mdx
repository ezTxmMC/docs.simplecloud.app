import { Note } from "../../components/mdx";

export const metadata = {
  title: 'Structure',
  description:
    'This guide will show you how SimpleCloud is internally structured.',
}

# Structure

SimpleCloud v3 has a new and more customizable structure. We have encapsulated all the core components to make it easier to extend your setup. This means you can easily replace all our [droplets](/droplet) and [plugins](/plugin) with your own implementations. {{ className: 'lead' }}

## File structure

SimpleCloud has its core components that are needed, but they can be installed and used however you want. This means theoretically you can use any file structure you want. However, we **don't recommend** that and advise you to structure your files like this, as it works best in our experience and makes it easier to extend your setup with our [CLI](/cli).

```
.
├── components
│   ├── .secrets
│   ├── auto-updater
│   │   ├── auto-updater.jar
│   │   └── versions.yml
│   ├── controller
│   │   ├── application.yml
│   │   ├── controller.properties
│   │   ├── controller-runtime.jar
│   │   ├── current_version.txt
│   │   └── database.db
│   ├── serverhost
│   │   ├── application.yml
│   │   ├── current_version.txt
│   │   ├── serverhost.properties
│   │   └── serverhost-runtime.jar
│   ├── libs
│   │   └── ...
│   └── scripts
│       ├── components
│       │   ├── controller.sh
│       │   └── serverhost.sh
│       ├── all.sh
│       ├── run.bat
│       ├── shutdown.bat
│       └── utils.sh
├── groups
│   ├── proxy.yml
│   └── lobby.yml
├── templates
│   ├── proxy
│   │   └── ...
│   └── lobby
│       └── ...
└── running
    ├── proxy
    │   └── proxy-1
    │       └── ...
    └── lobby
        └── lobby-1
            └── ...
```

<Note>
    Keep in mind that if you change your file structure, there might be some things that will not work with our [CLI](/cli).
</Note>

## Auto-Updater

The auto-updater is a crucial part of SimpleCloud, ensuring that all components stay up-to-date with the latest features and security patches. It resides in the `components/auto-updater` directory and manages version control through `versions.yml`. It is executed through the scripts in the `components/scripts` directory.

## Scripts

We decided to use a handful of scripts to make it easier to interact with SimpleCloud, and also to ensure you don't depend on our [CLI](/cli). You can find all scripts in the `components/scripts` directory. Each component has its own script for starting and stopping, and a `.properties` file to configure it. This setup allows you to easily configure your system.

### Script Commands

Every script in `components/scripts/components` requires a sub-command: `start`, `stop`, or `status`. These commands allow you to manage the lifecycle of each component.

### all.sh Script

The `all.sh` script is used to manage all components at once. It supports the same sub-commands (`start`, `stop`, `status`) to handle batch operations.

If any component fails to start, or is already running, the script skips it and continues with the next component. The scripts return a json object with the status of each component.

### Example Script

Here is an example of how the [controller](/controller) script and `.properties` file look:

```bash {{title: "components/scripts/components/controller.sh"}}
#!/bin/bash

SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
ROOT_DIR=$(dirname "$(dirname "$SCRIPT_DIR")")
source "$ROOT_DIR/scripts/utils.sh"

controller_session="simplecloud-controller"
controller_dir="$ROOT_DIR/controller"
controller_launcher="$controller_dir/controller-runtime.jar"

application_config="$controller_dir/application.yml"
versions_config="$ROOT_DIR/auto-updater/versions.yml"
current_version_file="$controller_dir/current_version.txt"
auto_updater_jar="$ROOT_DIR/auto-updater/auto-updater.jar"

controller_cmd="java -XX:+UseG1GC -XX:MaxGCPauseMillis=50 -XX:CompileThreshold=100 -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops -Xmx512m -Xms256m -jar $controller_launcher"

case "$1" in
    start)
        run_auto_updater "$auto_updater_jar" "$application_config" "$versions_config" "$current_version_file" "dev" "true"
        start_screen_if_not_running "$controller_session" "$controller_dir" "$controller_cmd"
        ;;
    stop)
        stop_java_process "controller-runtime.jar"
        ;;
    status)
        get_component_status "controller-runtime.jar" "$controller_session" "$application_config" "$current_version_file"
        ;;
    *)
        echo "Usage: $0 {start|stop|status}"
        exit 1
        ;;
esac
```

```properties {{title: "components/controller/controller.properties"}}
DATABASE_URL=jdbc:sqlite:database.db
GROUPS_PATH=../../groups
# GRPC Uncomment and change this if you want to change grpc defintions
GRPC_HOST=0.0.0.0
# GRPC_PORT=5816
# PUBSUB Uncomment and change this if you want to run pubsub on another port
# PUBSUB_GRPC_PORT=5817
AUTH_SECRET_PATH=../.secrets/auth.secret
```
